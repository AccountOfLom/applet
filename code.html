<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.staticfile.net/jquery/1.10.2/jquery.min.js">
    </script>
        <style>
            #title > td {
                font-size: 20px;
            }
            td {
                padding-right: 10px;
            } 
        </style>
</head>
<body>
    <center>
        <div style="margin-top: 60px;margin-bottom: 30px;">
            <h3>百度地图搜索</h3>
            关键字<input value="家具" type="text" name="keyword" id="keyword">&nbsp;
            城市<input value="赣州" type="text" name="city" id="city">&nbsp;
            <button onclick="query()">查询</button>

        </div>

        <div>
            <table id="data-tab"  style="border: 1px #f4f4f4 solid;">
                <!-- <tr id="title">
                    <td>店名</td>
                    <td>电话</td>
                    <td>地址</td>
                </tr> -->
                <!-- <tr>
                    <td>名门静音门锁(赣州店)</td>
                    <td>13177762716</td>
                    <td>赣州市章贡区粮油街大拇指幼儿园东南侧约50米</td>
                </tr> -->
            </table>
            <div id="footer" style="display: none;">
                第 <b><span id="page-index" >1</span></b> 页
                &emsp;
                <button onclick="pre()">上一页</button>
                &emsp;
                <button onclick="next()">下一页</button>
            </div>
        </div>
    </center>
</body>
</html>

<script>

    //函数内的变量，只能作用于这个函数，而函数外的，是全局变量
    var keyword = "";
    var city = "";

    //查询按钮触发方法
    function query()
    {
        //每次点击查询，重置页码
        $('#page-index').text(1)
        //从 input 取值
        keyword = $('#keyword').val();
        city = $('#city').val();
        // 判断有没有填写 关键字 和 城市，如果没有填写，则进行提示
        // “||” 两个竖线，是 “或(or)” 的意思，也叫做 “或” 运算
        // “&&” 两个&，是 “和(and)” 的意思，也叫做 “与” 运算
        if (keyword == "" || city == "") {
            alert("请输入查询条件");
            return;  //return 是 函数返回结果的意思，会终止函数的执行
        }
        req();
    }

    //下一页
    function next()
    {
        //获取当前页码
        var pageIndex = $('#page-index').text();
        //当前页码 + 1，注意，做运算前，字符串需先转为数字
        var curPageIndex = parseInt(pageIndex) + 1;
        //更新页码
        $('#page-index').text(curPageIndex)
        req();
    }

    //上一页
    function pre()
    {
        //获取当前页码
        var pageIndex = $('#page-index').text();
        if (pageIndex == 1) {
            alert("已经在第一页了！");
            return;
        }
        //当前页码 - 1，注意，做运算前，字符串需先转为数字
        var curPageIndex = parseInt(pageIndex) - 1;
        //更新页码
        $('#page-index').text(curPageIndex)
        req();
    }


    //发出ajax请求，获取数据
    function req()
    {
        //显示页脚
        $('#footer').css('display', 'block');

        //每次请求数据前，先清理掉table表格中的所有行
        $('tr').remove();

        // 判断有没有填写 关键字 和 城市，如果没有填写，则进行提示
        

        var pageIndex = $('#page-index').text();

        //ajax是js用来发出网络请求的方法
        // ajax 也是 http 请求
        $.ajax({
            "url":"https://html.7qiaoban.top/test/index.php", // 这是我的服务器接口地址，做了中转
            "type":"GET",
            "data":{
                "keyword": keyword,
                "boundary":"region(" + city + ")", //字符串拼接方式，同 python
                "page_size":20,
                "page_index":pageIndex
            },
            success:function(res) {
                //数据请求成功后，会执行这里的代码
                // console.log(res)
                
                //注意，当前拿到的数据是 字符串类型，必须转为 对象类型
                var jsonObj = JSON.parse(res);
                //声明一个data变量，
                var data = jsonObj.data;

                //添加表头
                $('#data-tab').append("<tr id='title'>"+
                    "<td>序号</td>" +
                    "<td>店名</td>" +
                    "<td>电话</td>" +
                    "<td>地址</td>" +
                    "</tr>");
                
                // 遍历/循环 所得到的 家具店的信息
                for (i in data) {
                    // console.log(data[i])
                    //在这里，把单个家具店的信息，组装成 table 中的 tr

                    var color = "";
                    if (i % 2 == 0) {
                        // % 是求余数，只有当前行为偶数时，有背景颜色
                        color = "#F4F4F4";
                    } 
                    
                    var number = parseInt(i) + 1;

                    var tr = "<tr style='background:"+ color +"'>" + 
                    "<td>" + number +"</td>" +
                    "<td>" + data[i].title +"</td>" +
                    "<td>" + data[i].tel +"</td>" +
                    "<td>" + data[i].address +"</td>" +
                    "</tr>"
                    // js的append，可以将元素添加到body中
                    $('#data-tab').append(tr);
                }

                //css选择器写法，在jq中可以兼容
                // $('#data-tab').append(tr);

            },
            error:function(err) {
                console.log(err)
            }
        });
    }
</script>
